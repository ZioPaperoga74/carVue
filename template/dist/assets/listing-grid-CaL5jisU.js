import{_ as v,ay as K,az as C,r as o,c,o as l,a as m,b as n,J as Y,F as g,e as f,n as d,M as u,t as k,K as F}from"./index-LMFVUyQs.js";const S=new F("http://127.0.0.1:8090"),R={components:{CarCard:C,ListingFilter:K},data(){return{cars:[],currentPage:1,totalPages:1,perPage:15,totalItems:0,title:"Auto in vendita",text:"Home",text1:"Auto",filters:{brand:"",model:"",maxPrice:"",minYear:"",maxYear:"",minKm:"",maxKm:"",fuel:"",transmission:"",sort:"recenti"}}},mounted(){const e=this.$route.query;console.log("Query ricevuta dalla home:",e),e.brand&&(this.filters.brand=e.brand),e.model&&(this.filters.model=e.model),e.maxPrice&&(this.filters.maxPrice=Number(e.maxPrice)),e.minYear&&(this.filters.minYear=Number(e.minYear)),e.maxKm&&(this.filters.maxKm=Number(e.maxKm)),console.log("Filtri applicati:",this.filters),this.fetchCars(1,this.filters)},methods:{async fetchCars(e=1,t=this.filters){try{let i=[];i.push("approved = true"),t.brand&&i.push(`brand = '${t.brand}'`),t.model&&i.push(`model = '${t.model}'`),t.minPrice&&i.push(`price >= ${t.minPrice}`),t.maxPrice&&i.push(`price <= ${t.maxPrice}`),t.minYear&&i.push(`year >= ${t.minYear}`),t.maxYear&&i.push(`year <= ${t.maxYear}`),t.minKm&&i.push(`mileage >= ${t.minKm}`),t.maxKm&&i.push(`mileage <= ${t.maxKm}`),t.fuel&&i.push(`fuel_type = '${t.fuel}'`),t.transmission&&i.push(`transmission = '${t.transmission}'`);const h=i.length?i.join(" && "):"";let s="-created";t.sort==="meno_costoso"&&(s="price"),t.sort==="piu_costoso"&&(s="-price"),t.sort==="recenti"&&(s="-created"),console.log("Listing Grid - Filter string:",h),console.log("Listing Grid - Sort:",s);const r=await S.collection("cars").getList(e,this.perPage,{filter:h,sort:s});this.cars=r.items,this.currentPage=r.page,this.totalPages=r.totalPages,this.totalItems=r.totalItems}catch(i){console.error("Errore nel recupero delle auto:",i)}},changePage(e){e>0&&e<=this.totalPages&&this.fetchCars(e,this.filters)},onSearch(e){this.filters={...this.filters,...e},this.fetchCars(1,this.filters)},onSidebarFilter(e){this.filters.minYear=e.yearRange[0],this.filters.maxYear=e.yearRange[1],this.filters.minKm=e.kmRange[0],this.filters.maxKm=e.kmRange[1],this.filters.minPrice=e.priceRange[0],this.filters.maxPrice=e.priceRange[1],this.filters.fuel=e.fuel,this.filters.transmission=e.transmission,this.fetchCars(1,this.filters)},onSidebarReset(){this.filters={brand:"",model:"",maxPrice:"",minYear:"",maxYear:"",minKm:"",maxKm:"",fuel:"",transmission:"",sort:"recenti"},this.fetchCars(1,this.filters)}}},w={class:"listing-page"},N={class:"section car-listing pt-0"},B={class:"container"},L={class:"row"},A={class:"col-lg-9"},M={class:"row"},G={key:0,class:"pagination-wrapper"},I={class:"pagination"},q=["onClick"];function z(e,t,i,h,s,r){const p=o("layouts-header"),_=o("breadcrumb"),x=o("listing-filter"),P=o("listing-sidebar"),b=o("car-card"),y=o("layout-footer");return l(),c("div",w,[m(p),m(_,{title:s.title,text:s.text,text1:s.text1},null,8,["title","text","text1"]),m(x,{onSearch:r.onSearch,selectedBrand:s.filters.brand,selectedModel:s.filters.model,maxPrice:s.filters.maxPrice,minYear:s.filters.minYear,maxKm:s.filters.maxKm,selectedOne:s.filters.sort},null,8,["onSearch","selectedBrand","selectedModel","maxPrice","minYear","maxKm","selectedOne"]),n("section",N,[n("div",B,[n("div",L,[m(P,{onApplyFilters:r.onSidebarFilter,onResetFilters:r.onSidebarReset},null,8,["onApplyFilters","onResetFilters"]),n("div",A,[n("div",M,[(l(!0),c(g,null,f(s.cars,a=>(l(),c("div",{class:"col-lg-4 col-md-6 col-12",key:a.id,"data-aos":"fade-down"},[m(b,{car:a},null,8,["car"])]))),128))]),s.totalPages>1?(l(),c("div",G,[n("ul",I,[n("li",{class:d({disabled:s.currentPage===1})},[n("a",{href:"#",onClick:t[0]||(t[0]=u(a=>r.changePage(s.currentPage-1),["prevent"]))},"«")],2),(l(!0),c(g,null,f(s.totalPages,a=>(l(),c("li",{key:a,class:d({active:s.currentPage===a})},[n("a",{href:"#",onClick:u(E=>r.changePage(a),["prevent"])},k(a),9,q)],2))),128)),n("li",{class:d({disabled:s.currentPage===s.totalPages})},[n("a",{href:"#",onClick:t[1]||(t[1]=u(a=>r.changePage(s.currentPage+1),["prevent"]))},"»")],2)])])):Y("",!0)])])])]),m(y)])}const Q=v(R,[["render",z]]);export{Q as default};
